# Minimal server config for testing bidirectional tunnel
server:
  config_version: "v1.0.0"
  tunnel_port: 10086
  entry_port: 8001
  log_level: "info"

# Egress: Server forwards client requests to external services
server_egress_upstream:
  upstreams:
    echo_backend:
      servers:
        - address: "echo.free.beeceptor.com:443"
          resolve: true
      lb_policy: "round_robin"
  rules:
    http:
      - match_host: "echo.free.beeceptor.com"
        action_upstream: "echo_backend"

# Tunnel management
tunnel_management:
  # Ingress: Server routes external requests to clients
  server_ingress_routing:
    rules:
      vhost:
        - match_host: "localhost"
          action_client_group: "test-group"

  # Client egress routing (forwarded to clients)
  client_configs:
    client_egress_routings:
      test-group:
        config_version: "v1.0.0"
        upstreams:
          echo_service:
            servers:
              - address: "echo.free.beeceptor.com:443"
                resolve: true
            lb_policy: "round_robin"
        rules:
          vhost:
            - match_host: "localhost"
              action_upstream: "echo_service"
